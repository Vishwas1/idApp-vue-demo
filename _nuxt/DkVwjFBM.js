import{_ as me,a as ge}from"./uoDSKYA2.js";import{f as fe,g as ve,r as d,h as Ie,i as Se,j as k,o as A,w as u,b as r,k as be,l as _,m as i,n as xe,a as c,c as we,p as P,q as Ce,d as v,t as D}from"./BEMtwttk.js";import{_ as he,s as Ae,c as Pe,g as Re}from"./BsrrYrCd.js";import{g as Y,v as Te,w as E}from"./COO27srU.js";import{I as z}from"./BghHf8Ak.js";import{C as ke,l as _e,a as N,g as H,b as O,s as Ue,c as Ve,f as Ke,d as qe,e as je,h as De,i as Ee}from"./uzHwbF_c.js";import{c as Ne,a as Oe}from"./BjWuQ266.js";import"./Dg19p0Ij.js";const Be={key:0},Me={class:"flex items-center gap-2"},U="Testnet",Le="https://grpc.testnet.concordium.com",$e=2e4,Je="https://wallet-proxy.testnet.concordium.com",We="https://testnet.ccdscan.io",tt=fe({__name:"demo",setup(Ge){const B=ve(),R=d({}),T=d(""),x=d(""),w=d(""),b=d(0),C=d(""),V=d({}),M=d(""),I=d(null),p=d(""),S=d(!1),K=d(!1),h=d([]),L=d(0),$=d({}),J=new ke(Le,$e),F=()=>{localStorage.clear()},Q=async()=>{F();const t=Y(E,256);localStorage.setItem("seed-phrase",t),p.value=t;const e=await W();localStorage.setItem("ip-info",JSON.stringify(e)),h.value=e,S.value=!0},X=async()=>{const t=p.value,e=Te(t,E);localStorage.setItem("seed-phrase",t),console.log(e),e?(console.log("Valid seed phrase"),S.value=!0):(console.log("Invalid seed phrase"),S.value=!1);const o=await W();h.value=o,localStorage.setItem("ip-info",JSON.stringify(o))},W=async()=>(await fetch(Je+"/v1/ip_info")).json(),Z=async t=>new Promise(async(o,n)=>{await _e(5e3,async()=>{try{const a=await(await fetch(t)).json();return z.Done===a.status?(o(a.token.identityObject.value),!1):z.Error===a.status?(n(a.detail),!1):!0}catch{return!0}})}),y=Ie(()=>h.value[L.value]);Se(()=>B.fullPath,()=>{p.value=localStorage.getItem("seed-phrase")||"",S.value=p.value.length>0,S.value&&X(),V.value=Object.fromEntries(new URLSearchParams(B.fullPath).entries()),V.value["/demo#code_uri"]&&(M.value=V.value["/demo#code_uri"],Z(M.value).then(t=>{console.log("Identity Object:",t),localStorage.setItem("identity-object",JSON.stringify(t)),I.value=t}).catch(t=>{console.error("Error fetching identity object:",t)}))},{immediate:!0});const ee=t=>Math.min(t-1,255),te=async(t,e)=>{try{const o={scope:"identity",response_type:"code",redirect_uri:H(),state:JSON.stringify({idObjectRequest:t})},n=new URLSearchParams(o),a=`${e}?${n.toString()}`,l=await fetch(a);if(l.redirected)return l.url;throw new Error("The identity provider did not redirect as expected.")}catch(o){return console.log(o.message),alert("An error occurred while sending the identity request. Maybe identity exists already. Try Recover Account"),null}},ne=()=>{localStorage.getItem("identity-index")==null&&localStorage.setItem("identity-index","0");const t=parseInt(localStorage.getItem("identity-index")||"0");return localStorage.setItem("identity-index",t.toString()),t},oe=async()=>{try{K.value=!1;const t=N.fromSeedPhrase(p.value,U),e=y.value.ipInfo.ipIdentity,o=ne(),n=t.getIdCredSec(e,o).toString("hex"),a=t.getPrfKey(e,o).toString("hex"),l=await J.getCryptographicParameters(),g=t.getSignatureBlindingRandomness(e,o).toString("hex"),f={arsInfos:y.value.arsInfos,arThreshold:ee(Object.keys(y.value.arsInfos).length),ipInfo:y.value.ipInfo,globalContext:l,idCredSec:n,prfKey:a,blindingRandomness:g};console.log("...........trying to create identity request");const s=Ne(f),m=await te(s,y.value.metadata.issuanceStart);if(m==null){alert("An error occurred while sending the identity request. Maybe identity exists already. Try Recover Account");return}m?.includes(H())?window.alert("An error occurred during the identity creation."):window.open(m,"_self")}catch(t){console.log(t)}},se=async t=>{ae(),le()},ae=async()=>{K.value=!1;const t=y.value.ipInfo.ipIdentity,e=0,o=await O(),l={idCredSec:N.fromSeedPhrase(p.value,U).getIdCredSec(t,e).toString("hex"),ipInfo:y.value.ipInfo,globalContext:o,timestamp:Math.floor(Date.now()/1e3)},g=Oe(l),f=await Ue(g,y.value.metadata.recoveryStart),s=await fetch(f);if(s.ok){const m=await s.json();localStorage.setItem("identity-object",JSON.stringify(m.value)),I.value=m.value}},le=async()=>{K.value=!1;const t=0,e=await O(),o=Ve(p.value,y.value.ipInfo.ipIdentity,e,t),n=await J.getAccountInfo(Ke(o));console.log(n),$.value=n.accountAddress},re=async(t,e=0)=>{const o=await O(),n=0,a=p.value;console.log("Account Seed:",a),console.log({credNumber:e});const{idCredSec:l,prfKey:g,attributeRandomness:f,blindingRandomness:s,credentialPublicKeys:m}=De(a,U,y.value.ipInfo.ipIdentity,n,e,t);console.log({idCredSec:l,prfKey:g,attributeRandomness:f,blindingRandomness:s,credentialPublicKeys:m});const ye={revealedAttributes:[],idObject:I.value,globalContext:o,credNumber:e,ipInfo:y.value.ipInfo,arsInfos:y.value.arsInfos,attributeRandomness:f,credentialPublicKeys:m,idCredSec:l,prfKey:g,sigRetrievelRandomness:s},pe=Ee(),q=Pe(ye,pe);console.log("Credential Transaction:",q);const j=Re(q.unsignedCdi.credId);return console.log(j),$.value=j.address,{credentialTransaction:q,accountAddress:j}},ie=()=>{b.value=b.value+1,G()},ce=async()=>{const t=Y(E,256);localStorage.setItem("account-seed-phrase",t),T.value=t,G()},G=()=>{const t=localStorage.getItem("account-seed-phrase")||"birth forget knife tube frame mistake month pair that viable gentle repair casino buzz grid team tenant drip year copy dice steel jaguar fruit",e=0,n=N.fromSeedPhrase(t,U).getAccountPublicKey(e,0,b.value).toString("hex"),a=qe(t,e,b.value);return w.value=n,C.value=a,x.value="",R.value={},{publicKey:n,signingKey:a}},de=async()=>{const{credentialTransaction:t,accountAddress:e}=await re(w.value,b.value);return R.value=t,x.value=e.address,{credentialTransaction:t,accountAddress:e}},ue=async()=>{try{const t=R.value;console.log(t);const e=await Ae(t,C.value),o=await je(t,e),n=`${We}/?dcount=1&dentity=transaction&dhash=${o.toString()}`;console.log("Transaction URL:",n),alert("Transaction successfully submitted. Press ok to check the transaction on CCDscan"),window.open(n,"_blank")}catch(t){alert("Error: "+t.message)}};return(t,e)=>{const o=me,n=Ce,a=ge,l=xe,g=he,f=be;return A(),k(l,null,{default:u(()=>[r(f,null,{default:u(()=>[i(I)?_("",!0):(A(),k(l,{key:0},{default:u(()=>[e[7]||(e[7]=c("h1",null," CREATE IDENTITY",-1)),e[8]||(e[8]=c("br",null,null,-1)),r(l,null,{default:u(()=>[e[6]||(e[6]=c("h4",null," IDP Seed: ",-1)),r(o,{modelValue:i(p),"onUpdate:modelValue":e[0]||(e[0]=s=>P(p)?p.value=s:null)},null,8,["modelValue"]),r(n,{type:"success",onClick:Q},{default:u(()=>[...e[5]||(e[5]=[v("Generate",-1)])]),_:1}),i(h).length>0?(A(),we("h4",Be," Select IDP: ")):_("",!0),r(a,{"v-model":i(L),options:i(h).map((s,m)=>({label:s.ipInfo.ipDescription.name,value:m})),label:"Select Identity Provider"},null,8,["v-model","options"]),r(n,{disabled:!i(S),label:"Create Identity",onClick:oe},null,8,["disabled"]),r(n,{disabled:!i(S),label:"Recover Identity",onClick:se},null,8,["disabled"])]),_:1})]),_:1})),i(I)?(A(),k(l,{key:1},{default:u(()=>[e[10]||(e[10]=c("h1",null," YOUR IDENTITY",-1)),e[11]||(e[11]=c("br",null,null,-1)),r(l,null,{default:u(()=>[e[9]||(e[9]=c("h3",null,"Identity",-1)),c("pre",null,D(i(I)?.attributeList?.chosenAttributes),1)]),_:1})]),_:1})):_("",!0),i(I)?(A(),k(l,{key:2},{default:u(()=>[e[22]||(e[22]=c("br",null,null,-1)),e[23]||(e[23]=c("h1",null," CREATE ACCOUNT",-1)),e[24]||(e[24]=c("br",null,null,-1)),r(l,null,{default:u(()=>[e[15]||(e[15]=c("h4",null," Account Seed: ",-1)),r(o,{modelValue:i(T),"onUpdate:modelValue":e[1]||(e[1]=s=>P(T)?T.value=s:null)},null,8,["modelValue"]),r(n,{type:"success",onClick:ce},{default:u(()=>[...e[12]||(e[12]=[v("Generate",-1)])]),_:1}),e[16]||(e[16]=c("br",null,null,-1)),e[17]||(e[17]=v(" PublicKey: ",-1)),c("div",Me,[r(g,{modelValue:i(w),"onUpdate:modelValue":e[2]||(e[2]=s=>P(w)?w.value=s:null),placeholder:"Public Key",class:"flex-1"},null,8,["modelValue"]),r(n,{onClick:ie},{default:u(()=>[v("+"+D(i(b)),1)]),_:1})]),e[18]||(e[18]=v(" SecretKey: ",-1)),r(g,{modelValue:i(C),"onUpdate:modelValue":e[3]||(e[3]=s=>P(C)?C.value=s:null),placeholder:"Secret Key",disabled:""},null,8,["modelValue"]),r(n,{type:"success",onClick:de},{default:u(()=>[...e[13]||(e[13]=[v("Request Cred Tx",-1)])]),_:1}),e[19]||(e[19]=c("h4",null," Account Credential Tx: ",-1)),c("pre",null,D(i(R)),1),r(n,{type:"success",onClick:ue},{default:u(()=>[...e[14]||(e[14]=[v("Submit Tx",-1)])]),_:1}),e[20]||(e[20]=c("br",null,null,-1)),e[21]||(e[21]=v(" AccountAddress: ",-1)),r(g,{modelValue:i(x),"onUpdate:modelValue":e[4]||(e[4]=s=>P(x)?x.value=s:null),placeholder:"Account Address"},null,8,["modelValue"])]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1})}}});export{tt as default};
