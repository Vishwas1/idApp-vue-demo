import{_ as me,a as ge}from"./Dd3j-nKy.js";import{f as fe,g as ve,r as u,h as Ie,i as Se,j as T,o as h,w as y,b as r,k as be,l as k,m as c,n as xe,a as d,c as _e,p as A,q as we,d as v,t as D}from"./DBBV_C1k.js";import{_ as Ce,s as he,c as Ae,g as Pe}from"./D8mQgEnq.js";import{g as Y,v as Re,w as E}from"./k4N5AtOj.js";import{I as z}from"./BghHf8Ak.js";import{C as Te,l as ke,a as N,g as H,b as O,s as Ue,c as Ve,f as Ke,d as qe,e as je,h as De,i as Ee}from"./C0c8pc9Q.js";import{c as Ne,a as Oe}from"./m44icXg6.js";import"./qLApFlfE.js";const Be={key:0},Me={class:"flex items-center gap-2"},U="Testnet",Le="https://grpc.testnet.concordium.com",$e=2e4,Je="https://wallet-proxy.testnet.concordium.com",We="https://testnet.ccdscan.io",tt=fe({__name:"demo",setup(Ge){const B=ve(),P=u({}),R=u(""),x=u(""),_=u(""),b=u(0),w=u(""),V=u({}),M=u(""),I=u(null),m=u(""),S=u(!1),K=u(!1),C=u([]),L=u(0),$=u({}),J=new Te(Le,$e),F=()=>{localStorage.clear()},Q=async()=>{F();const t=Y(E,256);localStorage.setItem("seed-phrase",t),m.value=t;const e=await W();localStorage.setItem("ip-info",JSON.stringify(e)),C.value=e,S.value=!0},X=async()=>{const t=m.value,e=Re(t,E);localStorage.setItem("seed-phrase",t),console.log(e),e?(console.log("Valid seed phrase"),S.value=!0):(console.log("Invalid seed phrase"),S.value=!1);const o=await W();C.value=o,localStorage.setItem("ip-info",JSON.stringify(o))},W=async()=>(await fetch(Je+"/v1/ip_info")).json(),Z=async t=>new Promise(async(o,n)=>{await ke(5e3,async()=>{try{const a=await(await fetch(t)).json();return z.Done===a.status?(o(a.token.identityObject.value),!1):z.Error===a.status?(n(a.detail),!1):!0}catch{return!0}})}),p=Ie(()=>C.value[L.value]);Se(()=>B.fullPath,()=>{m.value=localStorage.getItem("seed-phrase")||"",S.value=m.value.length>0,S.value&&X(),V.value=Object.fromEntries(new URLSearchParams(B.fullPath).entries()),V.value["/demo#code_uri"]&&(M.value=V.value["/demo#code_uri"],Z(M.value).then(t=>{console.log("Identity Object:",t),localStorage.setItem("identity-object",JSON.stringify(t)),I.value=t}).catch(t=>{console.error("Error fetching identity object:",t)}))},{immediate:!0});const ee=t=>Math.min(t-1,255),te=async(t,e)=>{try{const o={scope:"identity",response_type:"code",redirect_uri:H(),state:JSON.stringify({idObjectRequest:t})},n=new URLSearchParams(o),a=`${e}?${n.toString()}`,l=await fetch(a);if(l.redirected)return l.url;throw new Error("The identity provider did not redirect as expected.")}catch(o){return console.log(o.message),alert("An error occurred while sending the identity request. Maybe identity exists already. Try Recover Account"),null}},ne=()=>{localStorage.getItem("identity-index")==null&&localStorage.setItem("identity-index","0");const t=parseInt(localStorage.getItem("identity-index")||"0");return localStorage.setItem("identity-index",t.toString()),t},oe=async()=>{try{K.value=!1;const t=N.fromSeedPhrase(m.value,U),e=p.value.ipInfo.ipIdentity,o=ne(),n=t.getIdCredSec(e,o).toString("hex"),a=t.getPrfKey(e,o).toString("hex"),l=await J.getCryptographicParameters(),g=t.getSignatureBlindingRandomness(e,o).toString("hex"),f={arsInfos:p.value.arsInfos,arThreshold:ee(Object.keys(p.value.arsInfos).length),ipInfo:p.value.ipInfo,globalContext:l,idCredSec:n,prfKey:a,blindingRandomness:g};console.log("...........trying to create identity request");const s=Ne(f),i=await te(s,p.value.metadata.issuanceStart);if(i==null){alert("An error occurred while sending the identity request. Maybe identity exists already. Try Recover Account");return}i!=null&&i.includes(H())?window.alert("An error occurred during the identity creation."):window.open(i,"_self")}catch(t){console.log(t)}},se=async t=>{ae(),le()},ae=async()=>{K.value=!1;const t=p.value.ipInfo.ipIdentity,e=0,o=await O(),l={idCredSec:N.fromSeedPhrase(m.value,U).getIdCredSec(t,e).toString("hex"),ipInfo:p.value.ipInfo,globalContext:o,timestamp:Math.floor(Date.now()/1e3)},g=Oe(l),f=await Ue(g,p.value.metadata.recoveryStart),s=await fetch(f);if(s.ok){const i=await s.json();localStorage.setItem("identity-object",JSON.stringify(i.value)),I.value=i.value}},le=async()=>{K.value=!1;const t=0,e=await O(),o=Ve(m.value,p.value.ipInfo.ipIdentity,e,t),n=await J.getAccountInfo(Ke(o));console.log(n),$.value=n.accountAddress},re=async(t,e=0)=>{const o=await O(),n=0,a=m.value;console.log("Account Seed:",a),console.log({credNumber:e});const{idCredSec:l,prfKey:g,attributeRandomness:f,blindingRandomness:s,credentialPublicKeys:i}=De(a,U,p.value.ipInfo.ipIdentity,n,e,t);console.log({idCredSec:l,prfKey:g,attributeRandomness:f,blindingRandomness:s,credentialPublicKeys:i});const ye={revealedAttributes:[],idObject:I.value,globalContext:o,credNumber:e,ipInfo:p.value.ipInfo,arsInfos:p.value.arsInfos,attributeRandomness:f,credentialPublicKeys:i,idCredSec:l,prfKey:g,sigRetrievelRandomness:s},pe=Ee(),q=Ae(ye,pe);console.log("Credential Transaction:",q);const j=Pe(q.unsignedCdi.credId);return console.log(j),$.value=j.address,{credentialTransaction:q,accountAddress:j}},ie=()=>{b.value=b.value+1,G()},ce=async()=>{const t=Y(E,256);localStorage.setItem("account-seed-phrase",t),R.value=t,G()},G=()=>{const t=localStorage.getItem("account-seed-phrase")||"birth forget knife tube frame mistake month pair that viable gentle repair casino buzz grid team tenant drip year copy dice steel jaguar fruit",e=0,n=N.fromSeedPhrase(t,U).getAccountPublicKey(e,0,b.value).toString("hex"),a=qe(t,e,b.value);return _.value=n,w.value=a,x.value="",P.value={},{publicKey:n,signingKey:a}},de=async()=>{const{credentialTransaction:t,accountAddress:e}=await re(_.value,b.value);return P.value=t,x.value=e.address,{credentialTransaction:t,accountAddress:e}},ue=async()=>{try{const t=P.value;console.log(t);const e=await he(t,w.value),o=await je(t,e),n=`${We}/?dcount=1&dentity=transaction&dhash=${o.toString()}`;console.log("Transaction URL:",n),alert("Transaction successfully submitted. Press ok to check the transaction on CCDscan"),window.open(n,"_blank")}catch(t){alert("Error: "+t.message)}};return(t,e)=>{const o=me,n=we,a=ge,l=xe,g=Ce,f=be;return h(),T(l,null,{default:y(()=>[r(f,null,{default:y(()=>[c(I)?k("",!0):(h(),T(l,{key:0},{default:y(()=>[e[7]||(e[7]=d("h1",null," CREATE IDENTITY",-1)),e[8]||(e[8]=d("br",null,null,-1)),r(l,null,{default:y(()=>[e[6]||(e[6]=d("h4",null," IDP Seed: ",-1)),r(o,{modelValue:c(m),"onUpdate:modelValue":e[0]||(e[0]=s=>A(m)?m.value=s:null)},null,8,["modelValue"]),r(n,{type:"success",onClick:Q},{default:y(()=>e[5]||(e[5]=[v("Generate")])),_:1,__:[5]}),c(C).length>0?(h(),_e("h4",Be," Select IDP: ")):k("",!0),r(a,{"v-model":c(L),options:c(C).map((s,i)=>({label:s.ipInfo.ipDescription.name,value:i})),label:"Select Identity Provider"},null,8,["v-model","options"]),r(n,{disabled:!c(S),label:"Create Identity",onClick:oe},null,8,["disabled"]),r(n,{disabled:!c(S),label:"Recover Identity",onClick:se},null,8,["disabled"])]),_:1,__:[6]})]),_:1,__:[7,8]})),c(I)?(h(),T(l,{key:1},{default:y(()=>[e[10]||(e[10]=d("h1",null," YOUR IDENTITY",-1)),e[11]||(e[11]=d("br",null,null,-1)),r(l,null,{default:y(()=>{var s,i;return[e[9]||(e[9]=d("h3",null,"Identity",-1)),d("pre",null,D((i=(s=c(I))==null?void 0:s.attributeList)==null?void 0:i.chosenAttributes),1)]}),_:1,__:[9]})]),_:1,__:[10,11]})):k("",!0),c(I)?(h(),T(l,{key:2},{default:y(()=>[e[22]||(e[22]=d("br",null,null,-1)),e[23]||(e[23]=d("h1",null," CREATE ACCOUNT",-1)),e[24]||(e[24]=d("br",null,null,-1)),r(l,null,{default:y(()=>[e[15]||(e[15]=d("h4",null," Account Seed: ",-1)),r(o,{modelValue:c(R),"onUpdate:modelValue":e[1]||(e[1]=s=>A(R)?R.value=s:null)},null,8,["modelValue"]),r(n,{type:"success",onClick:ce},{default:y(()=>e[12]||(e[12]=[v("Generate")])),_:1,__:[12]}),e[16]||(e[16]=d("br",null,null,-1)),e[17]||(e[17]=v(" PublicKey: ")),d("div",Me,[r(g,{modelValue:c(_),"onUpdate:modelValue":e[2]||(e[2]=s=>A(_)?_.value=s:null),placeholder:"Public Key",class:"flex-1"},null,8,["modelValue"]),r(n,{onClick:ie},{default:y(()=>[v("+"+D(c(b)),1)]),_:1})]),e[18]||(e[18]=v(" SecretKey: ")),r(g,{modelValue:c(w),"onUpdate:modelValue":e[3]||(e[3]=s=>A(w)?w.value=s:null),placeholder:"Secret Key",disabled:""},null,8,["modelValue"]),r(n,{type:"success",onClick:de},{default:y(()=>e[13]||(e[13]=[v("Request Cred Tx")])),_:1,__:[13]}),e[19]||(e[19]=d("h4",null," Account Credential Tx: ",-1)),d("pre",null,D(c(P)),1),r(n,{type:"success",onClick:ue},{default:y(()=>e[14]||(e[14]=[v("Submit Tx")])),_:1,__:[14]}),e[20]||(e[20]=d("br",null,null,-1)),e[21]||(e[21]=v(" AccountAddress: ")),r(g,{modelValue:c(x),"onUpdate:modelValue":e[4]||(e[4]=s=>A(x)?x.value=s:null),placeholder:"Account Address"},null,8,["modelValue"])]),_:1,__:[15,16,17,18,19,20,21]})]),_:1,__:[22,23,24]})):k("",!0)]),_:1})]),_:1})}}});export{tt as default};
