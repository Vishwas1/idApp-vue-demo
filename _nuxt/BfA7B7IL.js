import{_ as F,a as Q}from"./Dd3j-nKy.js";import{f as X,z as Y,r as d,h as x,s as Z,j as ee,o as te,w as p,a as l,b as r,k as ne,d as i,q as oe,t as S,n as se}from"./DBBV_C1k.js";import{_ as ae,s as le,c as re,g as ie}from"./D8mQgEnq.js";import{g as ce,w as de}from"./k4N5AtOj.js";import{C as ue,a as pe,d as me,e as ye,b as O,h as ge,i as ve,c as fe,f as be}from"./C0c8pc9Q.js";import"./qLApFlfE.js";const Ie={class:"flex flex-col gap-2"},xe={class:"flex items-center gap-2"},Se={style:{"max-height":"200px","overflow-y":"auto"}},U="Testnet",Ce="https://grpc.testnet.concordium.com",_e=2e4,Ae="https://wallet-proxy.testnet.concordium.com",we="https://testnet.ccdscan.io",je=X({__name:"create-account",setup(ke){const C=Y("showLoader"),v=d({}),_=d(""),f=d(""),y=d(""),m=d(0),b=d(""),N=d([]),j=d(0),K=d({}),g=d(0),a=d(0),h=new ue(Ce,_e),P=x(()=>{const t=localStorage.getItem("identity-objects");let e=[];return t?e=JSON.parse(t):e=[],e}),R=x(()=>(console.log("idObjects.value",P.value.length),P.value.map((t,e)=>({label:`${t.attributeList.chosenAttributes.idDocNo} (${t.signature.substr(0,8)})`,value:e})))),I=x(()=>N.value[j.value]),J=x(()=>{const t=localStorage.getItem("identity-objects");let e=[];return t?e=JSON.parse(t):e=[],e[0]});Z(async()=>{const t=await $();localStorage.setItem("ip-info",JSON.stringify(t)),N.value=t;try{const e=JSON.parse(localStorage.getItem("identity-credentials")||"[]");e.length>0?(console.log("idObjects",e),a.value=e[e.length-1].credNumber+1):a.value=0}catch(e){console.error(e),a.value=0}});const $=async()=>(await fetch(Ae+"/v1/ip_info")).json(),B=async t=>{const e=await O(),s=g.value,n=localStorage.getItem("seed-phrase"),{idCredSec:o,prfKey:u,attributeRandomness:A,blindingRandomness:w,credentialPublicKeys:c}=ge(n,U,I.value.ipInfo.ipIdentity,s,a.value,t),H={revealedAttributes:[],idObject:J.value,globalContext:e,credNumber:a.value,ipInfo:I.value.ipInfo,arsInfos:I.value.arsInfos,attributeRandomness:A,credentialPublicKeys:c,idCredSec:o,prfKey:u,sigRetrievelRandomness:w},M=ve(),k=re(H,M);console.log("Credential Transaction:",k);const T=ie(k.unsignedCdi.credId);return console.log(T),K.value=T.address,{credentialTransaction:k,accountAddress:T}},D=async()=>{try{const t=localStorage.getItem("seed-phrase"),e=await O();let s=[];for(let n=0;n<20;n++){const o=fe(t,I.value.ipInfo.ipIdentity,e,n);try{const u=await h.getAccountInfo(be(o));u.credNumber=n,u.identityIndex=0,u.status="confirmed",s.push(u)}catch(u){console.error(u)}}localStorage.setItem("identity-credentials",JSON.stringify(s,(n,o)=>typeof o=="bigint"?Number(o):o)),window.location.reload()}catch(t){console.error(t)}},L=()=>{m.value=m.value+1,V()},q=()=>{a.value=a.value+1},z=()=>{if(a.value==0)return 0;a.value=a.value-1},E=async()=>{const t=ce(de,256);localStorage.setItem("account-seed-phrase",t),_.value=t,m.value=0,V()},V=()=>{const t=localStorage.getItem("account-seed-phrase")||"birth forget knife tube frame mistake month pair that viable gentle repair casino buzz grid team tenant drip year copy dice steel jaguar fruit",e=0,n=pe.fromSeedPhrase(t,U).getAccountPublicKey(e,0,m.value).toString("hex"),o=me(t,e,m.value);return y.value=n,b.value=o,f.value="",v.value={},{publicKey:n,signingKey:o}},W=async()=>{const{credentialTransaction:t,accountAddress:e}=await B(y.value,m.value);v.value=t,f.value=e.address;let s=localStorage.getItem("identity-credentials");return s?s=JSON.parse(s):s=[],s.push({type:"simple",accountAddress:e.address,accountCredentials:{0:{v:0,value:{type:"normal",contents:{ipIdentity:0,credentialPublicKeys:{threshold:1,keys:{0:{schemeId:"Ed25519",verifyKey:y.value}}},policy:{validTo:"202605",createdAt:"202505",revealedAttributes:{}},credId:t.unsignedCdi.credId,revocationThreshold:2}}}},credNumber:a.value,identityIndex:g.value,status:"in-progress"}),localStorage.setItem("identity-credentials",JSON.stringify(s,(n,o)=>typeof o=="bigint"?Number(o):o)),{credentialTransaction:t,accountAddress:e}},G=async()=>{try{C.value=!0;const t=v.value;console.log(t);const e=await le(t,b.value),s=await ye(t,e);C.value=!1;const n=`${we}/?dcount=1&dentity=transaction&dhash=${s.toString()}`;console.log("Transaction URL:",n),alert("Transaction successfully submitted. Press ok to check the transaction on CCDscan"),window.open(n,"_blank"),D()}catch(t){C.value=!1,alert("Error: "+t.message)}};return(t,e)=>{const s=F,n=oe,o=ae,u=Q,A=ne,w=se;return te(),ee(w,null,{default:p(()=>[l("div",Ie,[r(A,{style:{width:"100%"}},{default:p(()=>[e[11]||(e[11]=l("h4",null," Account Seed: ",-1)),r(s,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=c=>_.value=c)},null,8,["modelValue"]),r(n,{type:"success",onClick:E},{default:p(()=>e[5]||(e[5]=[i("Generate")])),_:1,__:[5]}),e[12]||(e[12]=l("br",null,null,-1)),e[13]||(e[13]=i(" PublicKey: ")),l("div",xe,[r(o,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=c=>y.value=c),placeholder:"Public Key",class:"flex-1"},null,8,["modelValue"]),r(n,{onClick:L},{default:p(()=>[i("+"+S(m.value),1)]),_:1})]),e[14]||(e[14]=i(" SecretKey: ")),r(o,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=c=>b.value=c),placeholder:"Secret Key",disabled:""},null,8,["modelValue"]),e[15]||(e[15]=i(" Select An Identity: ")),r(u,{"option-attribute":"label",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=c=>g.value=c),options:R.value,label:"Select An Identity",placeholder:"Choose one"},null,8,["modelValue","options"]),l("small",null,"Identity Index: "+S(g.value),1),e[16]||(e[16]=l("br",null,null,-1)),l("small",null,[e[7]||(e[7]=i("Credential Index: ")),r(n,{onClick:z},{default:p(()=>e[6]||(e[6]=[i("-")])),_:1,__:[6]})]),i(" "+S(a.value)+" ",1),r(n,{onClick:q},{default:p(()=>e[8]||(e[8]=[i("+")])),_:1,__:[8]}),e[17]||(e[17]=l("br",null,null,-1)),r(n,{type:"success",onClick:W},{default:p(()=>e[9]||(e[9]=[i("Request Cred Tx")])),_:1,__:[9]}),e[18]||(e[18]=l("h4",null," Account Credential Tx: ",-1)),l("div",Se,[l("pre",null,S(v.value),1)]),r(n,{type:"success",onClick:G},{default:p(()=>e[10]||(e[10]=[i("Sign & Submit Tx")])),_:1,__:[10]}),e[19]||(e[19]=l("br",null,null,-1)),e[20]||(e[20]=i(" AccountAddress: ")),r(o,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=c=>f.value=c),placeholder:"Account Address"},null,8,["modelValue"])]),_:1,__:[11,12,13,14,15,16,17,18,19,20]})])]),_:1})}}});export{je as default};
