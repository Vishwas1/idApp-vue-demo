import{A as $,a as B,o as c,D as q,u as z,_ as F}from"./CR6inIvv.js";import{f as M,r as i,z as G,U as H,s as J,i as Q,j as V,o as f,w as C,b as _,k as X,a as s,n as Y,c as h,F as P,v as E,t as p,m as Z,l as ee,d as b}from"./DBBV_C1k.js";import"./qLApFlfE.js";import"./k4N5AtOj.js";const oe={class:"flex justify-between items-center mb-2"},te={class:"divide-y divide-gray-200",style:{"max-height":"300px","overflow-y":"auto"}},ne={class:"flex flex-col"},se={class:"text-base font-medium text-white-800"},ae={class:"text-sm text-gray-500 whitespace-nowrap"},le={class:"text-sm text-gray-500 whitespace-nowrap"},ce={class:"text-sm text-gray-600 whitespace-nowrap"},ie=["onClick"],x="Testnet",me=M({__name:"enable-network-testnet",setup(re){const g=i(),n=i(),A=i(""),S=i(""),w=G("showLoader"),O=i(!1);i(localStorage.getItem("pk")),i(localStorage.getItem("accountAddress"));const N=async()=>{var e;await((e=n.value)==null?void 0:e.disconnectall()),window.location.reload()},k=["Ethereum","Concordium ("+x+")","Bitcoin"],T=H(k.reduce((e,o)=>(e[o]=!1,e),{}));function L(e,o){console.log(`${e} toggled to: ${o}`),I(),T[e]=o}const U=i([]),m=i([]),W=async e=>{var o;console.log({topic:e}),await((o=n.value)==null?void 0:o.disconnection(e)),window.location.reload()};J(async()=>{w.value=!0,n.value=new $,await n.value.initClient(),w.value=!1,g.value=new B(n.value),c.closePopup(),m.value=n.value.getListOfSessions(),U.value=n.value.getListOfPairing()}),Q(()=>{var e;return(e=n.value)==null?void 0:e.session},(e,o)=>{console.log({oldVal:o,newVal:e}),(e!=null||e!=null)&&(console.log("Wallect Connect Session Establised "+(e==null?void 0:e.topic)),A.value="",O.value=!0,I())});const I=async()=>{var e,o,t,r;if(console.log((e=n.value)==null?void 0:e.session),((o=n.value)==null?void 0:o.getListOfSessions().length)==0){if(console.log("No Wallet Connect Session"),w.value=!0,await j(),w.value=!1,m.value=n.value.getListOfSessions(),!n.value.uri){alert("Could not connect to wallet connect server, please reload the page and try again in sometime. ");return}c.invokeIdAppDeepLinkPopup({walletConnectUri:n.value.uri});return}c.invokeIdAppActionsPopup({onCreateAccount:K,onRecoverAccount:R,walletConnectSessionTopic:(r=(t=n.value)==null?void 0:t.getListOfSessions()[0])==null?void 0:r.topic})},j=async()=>{if(!n.value){console.error("WalletConnect client is not initialized"),c.closePopup();return}await n.value.connect(q.chainId)},D=async()=>{console.log("Opening openIdapp.."),/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)?(console.log("Opening Idapp on mobile..."),window.location.href=S.value):console.log("Opening Idapp on desktop...")},K=async()=>{var e;console.log("beefore calling createCCDAccount..."),(e=g.value)==null||e.createCCDAccount(x).then(async o=>{var v,a,u;if(!o){alert("Error: Could not create account from Idapp");return}const{create_acc_resp:t,public_key:r}=o;if(console.log(r),t.status==z.SUCCESS){const d=t.message;if(console.log("Recieved account creation response account_address "+d.accountAddress),console.log("ConcordiumIDAppSDK.signCredentialTransaction ..."),console.log({resp:d}),confirm("Signature Request: Please approve to sign the transaction?")){const y=await((v=g.value)==null?void 0:v.signTransaction(d.serializedCredentialDeploymentTransaction,x));if(!y){alert("Error: Could generate signature");return}console.log({signedCreddepTx:y}),console.log("ConcordiumIDAppSDK.submitCCDTransaction ...");try{const l=await((a=g.value)==null?void 0:a.submitTransaction(y.credentialDeploymentTransaction,y.signature,x));console.log({txHash:l==null?void 0:l.toString()}),console.log(o),alert(`Account created successfully with address: ${d==null?void 0:d.accountAddress} 

Transaction Hash: ${l==null?void 0:l.toString()}`),c.closePopup()}catch(l){alert(l==null?void 0:l.message),c.closePopup()}}else alert("Signature request rejected"),c.closePopup()}else console.log(t),alert(`Request rejected : ${(u=t==null?void 0:t.message)==null?void 0:u.details} `),window.location.reload()}).catch(o=>{c.closePopup(),console.error("Error creating account:",o),alert("Error creating account: "+o.message),window.location.reload()}),setTimeout(()=>{console.log("after calling createCCDAccount..."),console.log("Opening Idapp..."),S.value="concordiumidapp://id-signup",A.value="http://localhost:5173/id-signup",D(),console.log("after calling createCCDAccount...")},2e3)},R=async()=>{var o;const e=localStorage.getItem("pk");e?((o=g.value)==null||o.recoverCCDAccount(e).then(t=>{console.log(t),alert("Account recovered successfully with address: "+(t==null?void 0:t.account_address)),localStorage.setItem("accountAddress",t==null?void 0:t.account_address),c.closePopup()}).catch(t=>{c.closePopup(),console.error("Error recovering account:",t),alert("Error recovering account: "+t.message),window.location.reload()}),setTimeout(()=>{console.log("after calling onRecoverAccount..."),console.log("Opening Idapp..."),S.value="concordiumidapp://id-signup",A.value="http://localhost:5173/id-signup",D()},2e3)):alert("No pk found")};return(e,o)=>{const t=F,r=Y,v=X;return f(),V(r,null,{default:C(()=>[_(v,null,{default:C(()=>[o[0]||(o[0]=s("h2",null,"CHOOSE NETWORK",-1)),_(r,null,{default:C(()=>[(f(),h(P,null,E(k,a=>s("div",{key:a,class:"flex items-center justify-between",style:{"margin-top":"10px"}},[s("span",null,p(a),1),_(t,{"model-value":Z(T)[a],"onUpdate:modelValue":u=>L(a,u)},null,8,["model-value","onUpdate:modelValue"])])),64))]),_:1})]),_:1,__:[0]}),_(v,null,{default:C(()=>[s("div",oe,[s("h2",null,"ACTIVE CONNECTIONS ("+p(m.value.length)+")",1),m.value.length>0?(f(),h("button",{key:0,class:"px-3 py-1 text-sm text-red-600 border border-red-600 rounded hover:bg-red-50",onClick:N}," Disconnect All ")):ee("",!0)]),_(r,null,{default:C(()=>[s("ul",te,[(f(!0),h(P,null,E(m.value,a=>{var u;return f(),h("li",{key:a.topic,class:"flex justify-between items-center py-3"},[s("div",ne,[s("span",se,p(((u=a.peer.metadata)==null?void 0:u.name)||"Unknown App"),1),s("span",ae,[o[1]||(o[1]=s("strong",null,"Topic:",-1)),b(" "+p(a.topic||"No Topic"),1)]),s("span",le,[o[2]||(o[2]=s("strong",null,"Public Key:",-1)),b(" "+p(a.peer.publicKey||"No Publickey"),1)]),s("span",ce,[o[3]||(o[3]=s("strong",null,"Expires on:",-1)),b(" "+p(n.value.formatExpiryIST(a.expiry)),1)])]),s("button",{class:"ml-4 px-3 py-1 text-sm text-red-600 border border-red-600 rounded hover:bg-red-50",onClick:d=>W(a.topic)}," Disconnect ",8,ie)])}),128))])]),_:1})]),_:1})]),_:1})}}});export{me as default};
